<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Amazon Bedrock cookbook website"><meta name=author content=Bedrock-GTM><link href=https://github.amazon-bedrock-samples.com/rag/knowledge-bases/use-case-examples/rag-using-structured-unstructured-data/2_rag_with_structured_unstructured_data/ rel=canonical><link href=../1_create_sql_dataset_optional/ rel=prev><link href=../../../../open-source/chatbots/qa_chatbot_langchain_bedrock/ rel=next><link rel=icon href=../../../../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.49"><title>RAG with Structured and Unstructured Data - Amazon Bedrock Recipes</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.6f8fc17f.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title="Amazon Bedrock Recipes" class="md-header__button md-logo" aria-label="Amazon Bedrock Recipes" data-md-component=logo> <img src=../../../../../logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Amazon Bedrock Recipes </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> RAG with Structured and Unstructured Data </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=purple aria-hidden=true type=radio name=__palette id=__palette_0> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Github: Amazon-Bedrock-Samples </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="Amazon Bedrock Recipes" class="md-nav__button md-logo" aria-label="Amazon Bedrock Recipes" data-md-component=logo> <img src=../../../../../logo.png alt=logo> </a> Amazon Bedrock Recipes </label> <div class=md-nav__source> <a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Github: Amazon-Bedrock-Samples </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Intro to Amazon Bedrock </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Intro to Amazon Bedrock </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_1> <label class=md-nav__link for=__nav_2_1_1 id=__nav_2_1_1_label tabindex=0> <span class=md-ellipsis> API Usage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1_1> <span class="md-nav__icon md-icon"></span> API Usage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../introduction-to-bedrock/bedrock_apis/01_invoke_api/ class=md-nav__link> <span class=md-ellipsis> Invoke Model API Example </span> </a> </li> <li class=md-nav__item> <a href=../../../../../introduction-to-bedrock/bedrock_apis/04_agents_api/ class=md-nav__link> <span class=md-ellipsis> Agents API Example </span> </a> </li> <li class=md-nav__item> <a href=../../../../../introduction-to-bedrock/bedrock_apis/03_knowledgebases_api/ class=md-nav__link> <span class=md-ellipsis> Knowledge Bases API Example </span> </a> </li> <li class=md-nav__item> <a href=../../../../../introduction-to-bedrock/bedrock_apis/02_guardrails_api/ class=md-nav__link> <span class=md-ellipsis> Guardrail API Example </span> </a> </li> <li class=md-nav__item> <a href=../../../../../introduction-to-bedrock/converse_api/01_converse_api/ class=md-nav__link> <span class=md-ellipsis> Converse API Example </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Agents </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Agents </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1> <label class=md-nav__link for=__nav_2_2_1 id=__nav_2_2_1_label tabindex=0> <span class=md-ellipsis> Amazon Bedrock Agents </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1> <span class="md-nav__icon md-icon"></span> Amazon Bedrock Agents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/introduction-to-agents/how_to_create_custom_agents/ class=md-nav__link> <span class=md-ellipsis> How to create an Agent </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1_2> <label class=md-nav__link for=__nav_2_2_1_2 id=__nav_2_2_1_2_label tabindex=0> <span class=md-ellipsis> Bedrock Agent Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1_2> <span class="md-nav__icon md-icon"></span> Bedrock Agent Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/01-create-agent-with-function-definition/01-create-agent-with-function-definition/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Function Definition </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/02-create-agent-with-api-schema/02-create-agent-with-api-schema/ class=md-nav__link> <span class=md-ellipsis> Create Agent with API Schema </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/03-create-agent-with-return-of-control/03-create-agent-with-return-of-control/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Return of Control </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/04-create-agent-with-single-knowledge-base/04-create-agent-with-single-knowledge-base/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Single Knowledge Base </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/05-create-agent-with-knowledge-base-and-action-group/05-create-agent-with-knowledge-base-and-action-group/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Knowledge Base and Action Group </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/06-prompt-and-session-attributes/06-prompt-and-session-attributes/ class=md-nav__link> <span class=md-ellipsis> Prompt and Session Attributes </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/07-advanced-prompts-and-custom-parsers/07-custom-prompt-and-lambda-parsers/ class=md-nav__link> <span class=md-ellipsis> Custom Prompt and Lambda Parsers </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/08-create-agent-with-guardrails/08-create-agent-with-guardrails/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Guardrails </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/09-create-agent-with-memory/09-create-agent-with-memory/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Memory </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/10-create-agent-with-code-interpreter/10-create-agent-with-code-interpreter/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Code Interpreter </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/14-create-agent-with-custom-orchestration/custom_orchestration_example/ class=md-nav__link> <span class=md-ellipsis> Create Agent with Custom Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/features-examples/15-invoke-inline-agents/inline-agent-api-usage/ class=md-nav__link> <span class=md-ellipsis> Create Dynamic Tooling Inline Agents </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1_3> <label class=md-nav__link for=__nav_2_2_1_3 id=__nav_2_2_1_3_label tabindex=0> <span class=md-ellipsis> Bedrock Flows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1_3> <span class="md-nav__icon md-icon"></span> Bedrock Flows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/bedrock-flows/Getting_started_with_Prompt_Management_Flows/ class=md-nav__link> <span class=md-ellipsis> Getting Started with Prompt Management Flows </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1_4> <label class=md-nav__link for=__nav_2_2_1_4 id=__nav_2_2_1_4_label tabindex=0> <span class=md-ellipsis> Use Case Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1_4> <span class="md-nav__icon md-icon"></span> Use Case Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/use-case-examples/text-2-sql-agent/create_and_invoke_sql_agent/ class=md-nav__link> <span class=md-ellipsis> Text to SQL Agent </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/use-case-examples/agentsforbedrock-retailagent/workshop/test_retailagent_agentsforbedrock/ class=md-nav__link> <span class=md-ellipsis> Retail Agent Workshop </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/bedrock-agents/use-case-examples/product-review-agent/main/ class=md-nav__link> <span class=md-ellipsis> Product Review Agent </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> <span class=md-ellipsis> Function Calling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> Function Calling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/function-calling/function_calling_with_converse/function_calling_with_converse/ class=md-nav__link> <span class=md-ellipsis> Function Calling with Converse </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/function-calling/function_calling_with_invoke/function_calling_model_with_invoke/ class=md-nav__link> <span class=md-ellipsis> Function Calling with Invoke </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/function-calling/return_of_control/return_of_control/ class=md-nav__link> <span class=md-ellipsis> Return of Control </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/function-calling/tool_binding/tool_bindings/ class=md-nav__link> <span class=md-ellipsis> Tool Binding </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3> <label class=md-nav__link for=__nav_2_2_3 id=__nav_2_2_3_label tabindex=0> <span class=md-ellipsis> Open Source </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3> <span class="md-nav__icon md-icon"></span> Open Source </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3_1> <label class=md-nav__link for=__nav_2_2_3_1 id=__nav_2_2_3_1_label tabindex=0> <span class=md-ellipsis> CrewAI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3_1> <span class="md-nav__icon md-icon"></span> CrewAI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/crew.ai/Find%20dream%20destination%20with%20CrewAI/ class=md-nav__link> <span class=md-ellipsis> Find Dream Destination with CrewAI </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3_2> <label class=md-nav__link for=__nav_2_2_3_2 id=__nav_2_2_3_2_label tabindex=0> <span class=md-ellipsis> LangGraph </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3_2> <span class="md-nav__icon md-icon"></span> LangGraph </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/langgraph-single-agent/ class=md-nav__link> <span class=md-ellipsis> LangGraph Agent with Function Calling </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/langgraph-agents-multimodal/ class=md-nav__link> <span class=md-ellipsis> LangGraph Multi-Modal Agent with Function Calling </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/langgraph-multi-agent-sql-tools/ class=md-nav__link> <span class=md-ellipsis> LangGraph Multi Agent Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/02_medibot_V3_agents/ class=md-nav__link> <span class=md-ellipsis> LangGraph Multi Agent For Medical Chatbot </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/langgraph-fact-checker-feedback-loop/ class=md-nav__link> <span class=md-ellipsis> LangGraph Fact Checker with Multi Agent </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/langgraph-multi-agent-sql-tools/ class=md-nav__link> <span class=md-ellipsis> LangGraph Multi Agent Orchestration </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/03_langgraph_agents_of_agent/ class=md-nav__link> <span class=md-ellipsis> LangGraph Multi Agent with tools </span> </a> </li> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/open-source-agents/langgraph/Travel_planner_with_langgraph/ class=md-nav__link> <span class=md-ellipsis> Managing Memory for Multi Agents </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_3_3> <label class=md-nav__link for=__nav_2_2_3_3 id=__nav_2_2_3_3_label tabindex=0> <span class=md-ellipsis> Multi Agent </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_3_3> <span class="md-nav__icon md-icon"></span> Multi Agent </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../agents-and-function-calling/introduction-to-agents/how_to_create_multi_agents_from_custom_agents/ class=md-nav__link> <span class=md-ellipsis> Multi Agent Orchestration </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> RAG </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> RAG </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1 checked> <label class=md-nav__link for=__nav_2_3_1 id=__nav_2_3_1_label tabindex=0> <span class=md-ellipsis> Amazon Bedrock Knowledge Bases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_1> <span class="md-nav__icon md-icon"></span> Amazon Bedrock Knowledge Bases </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_1> <label class=md-nav__link for=__nav_2_3_1_1 id=__nav_2_3_1_1_label tabindex=0> <span class=md-ellipsis> Zero Setup </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_1_1> <span class="md-nav__icon md-icon"></span> Zero Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../features-examples/00-zero-setup-chat-with-your-document/chat_with_document_kb/ class=md-nav__link> <span class=md-ellipsis> Chat with Your Document </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_2> <label class=md-nav__link for=__nav_2_3_1_2 id=__nav_2_3_1_2_label tabindex=0> <span class=md-ellipsis> RAG Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_1_2> <span class="md-nav__icon md-icon"></span> RAG Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../features-examples/01-rag-concepts/01_create_ingest_documents_test_kb_multi_ds/ class=md-nav__link> <span class=md-ellipsis> Create and Ingest Documents with Multi-Data Sources </span> </a> </li> <li class=md-nav__item> <a href=../../../features-examples/01-rag-concepts/02_managed_rag_custom_prompting_and_no_of_results/ class=md-nav__link> <span class=md-ellipsis> Managed RAG with Custom Prompting </span> </a> </li> <li class=md-nav__item> <a href=../../../features-examples/01-rag-concepts/03_customized-rag-retreive-api-hybrid-search-claude-3-sonnet-langchain/ class=md-nav__link> <span class=md-ellipsis> Customized RAG with Claude 3 and Langchain </span> </a> </li> <li class=md-nav__item> <a href=../../../features-examples/01-rag-concepts/04_customized-rag-retreive-api-langchain-claude-evaluation-ragas/ class=md-nav__link> <span class=md-ellipsis> RAG Evaluation with Langchain and RAGAS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_3> <label class=md-nav__link for=__nav_2_3_1_3 id=__nav_2_3_1_3_label tabindex=0> <span class=md-ellipsis> Optimizing Retrieval Results </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_1_3> <span class="md-nav__icon md-icon"></span> Optimizing Retrieval Results </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../features-examples/02-optimizing-accuracy-retrieved-results/advanced_chunking_options/ class=md-nav__link> <span class=md-ellipsis> Advanced Chunking Options </span> </a> </li> <li class=md-nav__item> <a href=../../../features-examples/02-optimizing-accuracy-retrieved-results/csv_metadata_customization/ class=md-nav__link> <span class=md-ellipsis> CSV Metadata Customization </span> </a> </li> <li class=md-nav__item> <a href=../../../features-examples/02-optimizing-accuracy-retrieved-results/query_reformulation/ class=md-nav__link> <span class=md-ellipsis> Query Reformulation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_4> <label class=md-nav__link for=__nav_2_3_1_4 id=__nav_2_3_1_4_label tabindex=0> <span class=md-ellipsis> Advanced Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_1_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_1_4> <span class="md-nav__icon md-icon"></span> Advanced Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../features-examples/03-advanced-concepts/dynamic-metadata-filtering/dynamic-metadata-filtering-KB/ class=md-nav__link> <span class=md-ellipsis> Dynamic Metadata Filtering </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_4_2> <label class=md-nav__link for=__nav_2_3_1_4_2 id=__nav_2_3_1_4_2_label tabindex=0> <span class=md-ellipsis> Reranking </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_2_3_1_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_1_4_2> <span class="md-nav__icon md-icon"></span> Reranking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../features-examples/03-advanced-concepts/reranking/01_deploy-reranking-model-sm/ class=md-nav__link> <span class=md-ellipsis> Deploy Reranking Model </span> </a> </li> <li class=md-nav__item> <a href=../../../features-examples/03-advanced-concepts/reranking/02_kb-reranker/ class=md-nav__link> <span class=md-ellipsis> Knowledge Base Reranker </span> </a> </li> <li class=md-nav__item> <a href=../../../features-examples/03-advanced-concepts/reranking/qa-generator/ class=md-nav__link> <span class=md-ellipsis> QA Generator </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_5> <label class=md-nav__link for=__nav_2_3_1_5 id=__nav_2_3_1_5_label tabindex=0> <span class=md-ellipsis> Responsible AI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_1_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_1_5> <span class="md-nav__icon md-icon"></span> Responsible AI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../features-examples/05-responsible-ai/contextual-grounding/ class=md-nav__link> <span class=md-ellipsis> Contextual Grounding </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_6 checked> <label class=md-nav__link for=__nav_2_3_1_6 id=__nav_2_3_1_6_label tabindex=0> <span class=md-ellipsis> Use Case Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_1_6_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_1_6> <span class="md-nav__icon md-icon"></span> Use Case Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_6_1> <label class=md-nav__link for=__nav_2_3_1_6_1 id=__nav_2_3_1_6_1_label tabindex=0> <span class=md-ellipsis> Metadata Filter Access Control </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_2_3_1_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_1_6_1> <span class="md-nav__icon md-icon"></span> Metadata Filter Access Control </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../metadata-filter-access-control/kb-end-to-end-acl/ class=md-nav__link> <span class=md-ellipsis> End-to-End ACL with Knowledge Base </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_6_2 checked> <label class=md-nav__link for=__nav_2_3_1_6_2 id=__nav_2_3_1_6_2_label tabindex=0> <span class=md-ellipsis> RAG with Structured and Unstructured Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_2_3_1_6_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_1_6_2> <span class="md-nav__icon md-icon"></span> RAG with Structured and Unstructured Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../0-create-dummy-structured-data/ class=md-nav__link> <span class=md-ellipsis> Create Dummy Structured Data </span> </a> </li> <li class=md-nav__item> <a href=../1_create_sql_dataset_optional/ class=md-nav__link> <span class=md-ellipsis> Create SQL Dataset (Optional) </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> RAG with Structured and Unstructured Data </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2> <label class=md-nav__link for=__nav_2_3_2 id=__nav_2_3_2_label tabindex=0> <span class=md-ellipsis> Open Source </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_2> <span class="md-nav__icon md-icon"></span> Open Source </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../open-source/chatbots/qa_chatbot_langchain_bedrock/ class=md-nav__link> <span class=md-ellipsis> Chatbot using Langchain </span> </a> </li> <li class=md-nav__item> <a href=../../../../open-source/chunking/rag_chunking_strategies_langchain_bedrock/ class=md-nav__link> <span class=md-ellipsis> Chunking strategies for RAG applications </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2_3> <label class=md-nav__link for=__nav_2_3_2_3 id=__nav_2_3_2_3_label tabindex=0> <span class=md-ellipsis> Vector Stores </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_2_3> <span class="md-nav__icon md-icon"></span> Vector Stores </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../open-source/vector_stores/rag_langchain_bedrock_opensearch/ class=md-nav__link> <span class=md-ellipsis> Langchain Chatbot with Opensearch </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> Model Customization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Model Customization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../custom-models/model-distillation/Historical_invocation_distillation/ class=md-nav__link> <span class=md-ellipsis> Model Distillation with Invocation Logs </span> </a> </li> <li class=md-nav__item> <a href=../../../../../custom-models/model-distillation/Distillation-via-S3-input/ class=md-nav__link> <span class=md-ellipsis> Model Distillation with S3 Data </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Gen AI Usecases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Gen AI Usecases </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Text Generation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Text Generation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../genai-use-cases/text-generation/how_to_work_with_text_generation_w_bedrock/ class=md-nav__link> <span class=md-ellipsis> Streaming Response with Converse </span> </a> </li> <li class=md-nav__item> <a href=../../../../../genai-use-cases/text-generation/how_to_work_with_code_generation_w_bedrock/ class=md-nav__link> <span class=md-ellipsis> Generate Python Code with Converse </span> </a> </li> <li class=md-nav__item> <a href=../../../../../genai-use-cases/text-generation/how_to_work_with_text_translation_w_bedrock/ class=md-nav__link> <span class=md-ellipsis> Text Translation with Converse </span> </a> </li> <li class=md-nav__item> <a href=../../../../../genai-use-cases/text-generation/how_to_work_with_text-summarization-titan%2Bclaude/ class=md-nav__link> <span class=md-ellipsis> Text summarization with Converse </span> </a> </li> <li class=md-nav__item> <a href=../../../../../genai-use-cases/text-generation/how_to_work_with_batch_example_for_multi_threaded_invocation/ class=md-nav__link> <span class=md-ellipsis> Generate Bulk Emails with Batch Inference </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Workshops </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Workshops </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> Open-source L400 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Open-source L400 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/01_usecase_introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction to the Use Case </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/02_Lab_Find%20a%20Dream%20Destination_RAG%20query/ class=md-nav__link> <span class=md-ellipsis> Advanced RAG for Agents </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/02_travel_planner_with_langgraph/ class=md-nav__link> <span class=md-ellipsis> Conversational Memory in Agents </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/03_travel_agent_with_tools/ class=md-nav__link> <span class=md-ellipsis> Multi-Modal and Types of Agents </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/04_travel_booking_multi_agent/ class=md-nav__link> <span class=md-ellipsis> Multi-Agent Collaboration with Human-in-loop </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/05_dream_destination_with_crewai/ class=md-nav__link> <span class=md-ellipsis> Find Dream Destination with CrewAI </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/06_agent_evaluation_with_ragas/ class=md-nav__link> <span class=md-ellipsis> RAGAs Agents Evaluation </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l400/07_dynamic_tooling_agents/ class=md-nav__link> <span class=md-ellipsis> Dynamic Tool invocation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Open-source L200 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Open-source L200 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l200/02_contextual_text_generation/ class=md-nav__link> <span class=md-ellipsis> Introduction to the Use Case </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l200/03_retrieval_based_text_application/ class=md-nav__link> <span class=md-ellipsis> Retrieval Based Text Generation </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l200/04_retrieval_based_chat_application/ class=md-nav__link> <span class=md-ellipsis> Retrieval Based Chat Application </span> </a> </li> <li class=md-nav__item> <a href=../../../../../workshop/open-source-l200/05_agent_based_text_generation/ class=md-nav__link> <span class=md-ellipsis> Agent Based Text Generation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../general/tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> <li class=md-nav__item> <a href=../../../../../general/license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <nav class=md-tags> <a href=../../../../../general/tags/#rag-knowledge-bases class="md-tag md-tag-icon">RAG/ Knowledge-Bases</a> <a href=../../../../../general/tags/#rag-data-ingestion class="md-tag md-tag-icon">RAG/ Data-Ingestion</a> <a href=../../../../../general/tags/#agents-multi-agent-orchestration class="md-tag md-tag-icon">Agents/ Multi-Agent-Orchestration</a> </nav> <h1>RAG with Structured and Unstructured Data</h1> <div class="admonition tip inline end"> <p class=admonition-title><a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main/rag/knowledge-bases/use-case-examples/rag-using-structured-unstructured-data/2_rag_with_structured_unstructured_data.ipynb target=_blank>Open in github</a></p> </div> <h2>RAG with structured and unstructed data</h2> <p>This notebook demonstrates how to leverage multiple data sources, including structured data from a database and unstructed data (like pdf, txt, etc.), to answer questions using Retrieval Augmented Generation (RAG). Specifically, we'll show how to integrate a knowledge base and a database to retrieve relevant information and generate comprehensive natural language responses.</p> <p>We'll set up a <code>MultiRetrievalQAChain</code> that can answer queries by retrieving information from an Amazon Bedrock knowledge base and a database (using Text-to-SQL as a retriever), and then generating responses using the Claude 3.0 Sonnet language model. The <code>MultiRetrievalQAChain</code> can intelligently determine the appropriate data source for a given question, fetch relevant information, maintain conversation context, and synthesize the retrieved data into a coherent natural language answer. Here's a diagram illustrating the workflow:</p> <p><img alt="Multiple Retrievers in a QA Chain Image" src=./image/Text2SQL-RAG.png></p> <h4>Background</h4> <p>The <code>MultiRetrievalQAChain</code> is an advanced implementation of the Retrieval Augmented Generation (RAG) approach, which combines the strengths of retrieval-based and generation-based language models. By integrating multiple retrievers, each specialized in a different data source, the chain can leverage diverse information sources to generate comprehensive and accurate responses. In this notebook, we'll demonstrate how to use structured data from a database (retrieved using Text-to-SQL as a retriever) as well as a text-based knowledge base to power a RAG application.</p> <p><strong>Note:</strong> This notebook uses a custom module designed specifically for Amazon Athena, but you can easily adapt it for other databases like Amazon Redshift and Amazon RDS by using their respective data APIs.</p> <h4>Prerequisites</h4> <p><strong>Note:</strong> This notebook assumes that you have 1. created a knowledge base for Amazon Bedrock using unstructred data 2. have data available for querying via SQL in Amazon Athena.</p> <p>If you haven't met the prerequisite, please follow these steps:</p> <ol> <li>Create a knowledge base and ingest your documents by following this <a href=https://github.com/aws-samples/amazon-bedrock-samples/blob/main/knowledge-bases/features-examples/01-rag-concepts/01_create_ingest_documents_test_kb_multi_ds.ipynb>01_create_ingest_documents_test_kb_multi_ds.ipynb</a>.</li> <li>Note down the knowledge base ID, as you'll need it later in this notebook.</li> <li>If you need to use synthetic data for testing, refer to this <a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main/knowledge-bases/features-examples/synthetic_dataset>link</a> to get synthetic text data that you can use to create your knowledge base for Amazon bedrock.</li> <li>To create synthetic structured data, you can run <a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main/knowledge-bases/use-case-examples/rag-using-structured-unstructured-data/0-create-dummy-structured-data.ipynb>0-create-dummy-structured-data.ipynb</a> notebook and then use <a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main/knowledge-bases/use-case-examples/rag-using-structured-unstructured-data/1_create_sql_dataset_optional.ipynb>1_create_sql_dataset_optional.ipynb</a> notebook to create a database and table in Amazon Athena.</li> </ol> <p><strong>Note</strong>: The <code>custom_database_retriever.py</code> file currently uses table schema for a retail order website generated by using <a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main/knowledge-bases/use-case-examples/rag-using-structured-unstructured-data/0-create-dummy-structured-data.ipynb>0-create-dummy-structured-data.ipynb</a> notebook. If you choose to use a different dataset, please update the schema for tables and table information inside <code>custom_database_retriever.py</code> file.</p> <h2>Setup</h2> <h3>Setp up the custom retriever for `Text-to-SQL`</h3> <p>The code for the custom module can be found in <code>CustomDatabaseRetriever.py</code>.</p> <p>The provided code defines a retriever class called <code>AmazonAthenaRetriever</code> that retrieves relevant data from an Amazon Athena database using SQL queries generated by Amazon Bedrock. The retriever interacts with the Athena database through the AWS boto3 SDK, which allows running SQL queries on data stored in Amazon S3. It generates SQL queries based on natural language input, executes the queries on Athena, and returns the results as a list of documents formatted for a LangChain RetrievalQA chain.</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>boto3</span>
<span class=kn>from</span> <span class=nn>custom_database_retriever</span> <span class=kn>import</span> <span class=n>AmazonAthenaRetriever</span> <span class=c1># import AmazonAthenaRetriever for Text-2-SQL</span>

<span class=n>athena_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s2>&quot;athena&quot;</span><span class=p>)</span>
<span class=n>bedrock_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;bedrock-runtime&#39;</span><span class=p>)</span>
<span class=n>bedrock_agent_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s2>&quot;bedrock-agent-runtime&quot;</span><span class=p>)</span>
</code></pre></div> <p>Retrieve stored glue database information from <code>0_create_sql_dataset_optional.ipynb</code>. You should comment this if you did not run <code>0_create_sql_dataset_optional.ipynb</code> notebook to setup Amazon Athena database. </p> <div class=highlight><pre><span></span><code><span class=o>%</span><span class=n>store</span> <span class=o>-</span><span class=n>r</span> <span class=n>glue_database_name</span>
</code></pre></div> <h4>Configure variables</h4> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>define</span> <span class=n>the</span> <span class=n>model</span> <span class=n>of</span> <span class=n>your</span> <span class=n>choice</span><span class=p>:</span> <span class=n>defaults</span> <span class=n>to</span> <span class=n>Claude</span> <span class=mf>3.0</span> <span class=n>Sonnet</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>model_id</span> <span class=o>=</span> <span class=s2>&quot;anthropic.claude-3-sonnet-20240229-v1:0&quot;</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>define</span> <span class=n>Athena</span> <span class=n>output</span> <span class=n>location</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>RESULT_OUTPUT_LOCATION</span> <span class=o>=</span> <span class=s2>&quot;s3://&lt;Your-Bucket-Name&gt;/&quot;</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>define</span> <span class=n>the</span> <span class=n>database</span> <span class=n>you</span> <span class=n>are</span> <span class=n>using</span> <span class=ow>in</span> <span class=n>Amazon</span> <span class=n>Athena</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>database</span><span class=o>=</span><span class=s1>&#39;&lt;Your-database-name&gt;&#39;</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>database</span> <span class=o>=</span> <span class=s1>&#39;default&#39;</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>glue_database_name</span> <span class=k>else</span> <span class=n>glue_database_name</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>define</span> <span class=n>the</span> <span class=n>knowledge</span> <span class=n>base</span> <span class=nb>id</span> <span class=n>that</span> <span class=n>you</span> <span class=n>have</span> <span class=n>already</span> <span class=n>prepared</span> <span class=ow>in</span> <span class=n>Amazon</span> <span class=n>Bedrock</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>kb_id</span> <span class=o>=</span> <span class=s1>&#39;&lt;Your-Knowledgebase-Id&gt;&#39;</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>configure</span> <span class=n>how</span> <span class=n>many</span> <span class=n>chunks</span> <span class=n>do</span> <span class=n>you</span> <span class=n>want</span> <span class=k>for</span> <span class=n>model</span> <span class=n>response</span> <span class=n>generation</span><span class=o>.</span> <span class=n>these</span> <span class=n>chunks</span> <span class=n>are</span> <span class=n>retrieved</span> <span class=kn>from</span> <span class=nn>Knowledge</span> <span class=n>base</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>numberOfResults</span> <span class=o>=</span> <span class=mi>3</span> <span class=c1># can be configured (its the number chunks in knowledge base)</span>
</code></pre></div> <p>Setup the custom retreiver <code>AmazonAthenaRetriever</code> that when invoked takes user input to write and execute a SQL query, and finally provide the data back as Langchain documents.</p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Configure</span> <span class=n>SQL</span> <span class=n>Retriever</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>sql_retriever</span> <span class=o>=</span> <span class=n>AmazonAthenaRetriever</span><span class=p>(</span>
    <span class=n>athena_client</span><span class=o>=</span><span class=n>athena_client</span><span class=p>,</span>
    <span class=n>bedrock_client</span><span class=o>=</span><span class=n>bedrock_client</span><span class=p>,</span>
    <span class=n>database</span><span class=o>=</span><span class=n>database</span><span class=p>,</span>
    <span class=n>RESULT_OUTPUT_LOCATION</span><span class=o>=</span><span class=n>RESULT_OUTPUT_LOCATION</span><span class=p>,</span>
    <span class=n>model_id</span><span class=o>=</span><span class=n>model_id</span>
    <span class=p>)</span>
</code></pre></div> <h4>Test the sql retriever</h4> <p><strong>Note:</strong> The executed SQL is at the end of the Document inside the metadata. The last object's metadata is configured to always have the Execution ID (from Athena) and SQL query.</p> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>time</span>
<span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;Top 5 customers that spend most amount?&quot;</span>
<span class=n>response</span> <span class=o>=</span> <span class=n>sql_retriever</span><span class=o>.</span><span class=n>get_relevant_documents</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>check</span> <span class=n>response</span> <span class=n>of</span> <span class=n>SQL</span> <span class=n>Retreiver</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</code></pre></div> <h3>Configure Knowledgebase Retriever</h3> <p>Now, lets use publicly available <code>AmazonKnowledgeBasesRetriever</code> from Langchain to use Knowledgebases for Amazon Bedrock. This implementation makes it easy to use your knowledge base when you are using langchain. The source for this module uses <code>Retrieve</code> API for Knowledgebase on Amazon bedrock using boto3 SDK. </p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Configure</span> <span class=n>Knowledge</span> <span class=n>Base</span> <span class=n>Retriever</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=kn>from</span> <span class=nn>langchain_community.retrievers</span> <span class=kn>import</span> <span class=n>AmazonKnowledgeBasesRetriever</span>

<span class=n>kb_retriever</span> <span class=o>=</span> <span class=n>AmazonKnowledgeBasesRetriever</span><span class=p>(</span>
    <span class=n>client</span><span class=o>=</span><span class=n>bedrock_agent_client</span><span class=p>,</span>
    <span class=n>knowledge_base_id</span><span class=o>=</span><span class=n>kb_id</span><span class=p>,</span>
    <span class=n>retrieval_config</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;vectorSearchConfiguration&quot;</span><span class=p>:</span> 
                      <span class=p>{</span><span class=s2>&quot;numberOfResults&quot;</span><span class=p>:</span> <span class=n>numberOfResults</span><span class=p>}}</span>
    <span class=p>)</span>
</code></pre></div> <h4>Test Knowledge base retriever </h4> <p><strong>Note:</strong> You do have to use Langchain in order to use Knowledge base for Amazon Bedrock. This is one of the way you can use Knowledge Base when you are using langchain for your project/application.</p> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>time</span>
<span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;By what percentage did AWS revenue grow year-over-year in 2022?&quot;</span>
<span class=n>kb_retriever</span><span class=o>.</span><span class=n>get_relevant_documents</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</code></pre></div> <h3>Configure Multi QA Retriever Chain</h3> <p>The following code sets up a <code>MultiRetrievalQAChain</code> using the LangChain library. This chain can retrieve information from multiple data sources and employ a large language model (LLM) hosted on Amazon Bedrock to respond to user queries in a natural, contextual manner.</p> <p>The MultiRetrievalQAChain defines two retrievers: <code>one for a knowledge base</code> and <code>another for a database</code> containing name and description to help the MultiRetrievalQAChain determine which retriever is most appropriate for answering a given query. </p> <p>A <code>default conversation chain</code> manages the back-and-forth dialogue between the user and the system. It utilizes the LLM, a custom prompt, and a memory buffer to track the conversation's context.</p> <p>The central component is the MultiRetrievalQAChain itself, which combines the knowledge base retriever, database retriever, and default conversation chain. Based on the user's query, this chain determines the appropriate retriever, retrieves relevant information from the corresponding data source, and then employs the LLM to generate a contextual response informed by the conversation history.</p> <p>This sophisticated system can handle a diverse range of queries, from general questions to complex analytical database queries, providing natural language responses by synthesizing information from multiple sources.</p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=kn>from</span> <span class=nn>langchain.chains</span> <span class=kn>import</span> <span class=n>RetrievalQA</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=kn>from</span> <span class=nn>langchain_community.chat_models</span> <span class=kn>import</span> <span class=n>BedrockChat</span>
<span class=kn>from</span> <span class=nn>langchain.chains.router.multi_retrieval_qa</span> <span class=kn>import</span> <span class=n>MultiRetrievalQAChain</span>
<span class=kn>from</span> <span class=nn>langchain.chains</span> <span class=kn>import</span> <span class=n>ConversationChain</span>
<span class=kn>from</span> <span class=nn>langchain.callbacks.streaming_stdout</span> <span class=kn>import</span> <span class=n>StreamingStdOutCallbackHandler</span>
<span class=kn>from</span> <span class=nn>langchain.memory</span> <span class=kn>import</span> <span class=n>ConversationBufferMemory</span>
<span class=kn>from</span> <span class=nn>langchain.prompts</span> <span class=kn>import</span> <span class=n>PromptTemplate</span>

<span class=n>boto3_bedrock</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;bedrock-runtime&#39;</span><span class=p>)</span>
<span class=n>inference_params</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;max_tokens&quot;</span><span class=p>:</span><span class=mi>4096</span><span class=p>,</span> 
                    <span class=s2>&quot;temperature&quot;</span><span class=p>:</span><span class=mf>0.01</span><span class=p>,</span>
                    <span class=s2>&quot;top_k&quot;</span><span class=p>:</span><span class=mi>250</span><span class=p>,</span>
                    <span class=s2>&quot;top_p&quot;</span><span class=p>:</span><span class=mf>0.01</span><span class=p>,</span>
                    <span class=s2>&quot;stop_sequences&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>Human&quot;</span><span class=p>]</span>
                   <span class=p>}</span>
<span class=n>verbose</span> <span class=o>=</span> <span class=kc>False</span>
</code></pre></div> <p>Let's define the two retrievers that will be used by the MultiRetrievalQAChain later on in this notebook. The <code>retriever_infos</code> component is crucial for correct intent classification as it contains the description of the retrievers. If for some reason you see an incorrect classification for your use case, this is probably the first place to begin your troubleshooting. You want the retriever description to be simple, concise, and clear. </p> <p>Note: In this workshop, we are using the MultiRetrievalQAChain with only two retrievers but this chain can use more than two retrievers if needed.</p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Create</span> <span class=n>retriever</span> <span class=n>names</span> <span class=ow>and</span> <span class=n>descriptions</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>retriever_names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;kb_retriever&quot;</span><span class=p>,</span> <span class=s2>&quot;sql_retriever&quot;</span><span class=p>]</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Create</span> <span class=n>a</span> <span class=nb>list</span> <span class=n>of</span> <span class=n>retrievers</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>retrievers</span> <span class=o>=</span> <span class=p>[</span><span class=n>kb_retriever</span><span class=p>,</span> <span class=n>sql_retriever</span><span class=p>]</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Retriever</span> <span class=n>Information</span> <span class=n>used</span> <span class=n>by</span> <span class=n>Router</span> <span class=n>to</span> <span class=n>determine</span> <span class=n>which</span> <span class=n>retriever</span> <span class=n>to</span> <span class=n>use</span> <span class=k>for</span> <span class=n>the</span> <span class=n>question</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>retriever_infos</span> <span class=o>=</span> <span class=p>[</span>
<span class=p>{</span>
<span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;kb_retriever&quot;</span><span class=p>,</span>
<span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s1>&#39;Suitable for answering questions related to Amazon business, services, and latest launches based on shaeholder letter by CEO.&#39;</span><span class=p>,</span>
<span class=s2>&quot;retriever&quot;</span><span class=p>:</span> <span class=n>kb_retriever</span>
<span class=p>},</span>
<span class=p>{</span>
<span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;sql_retriever&quot;</span><span class=p>,</span>
<span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s1>&#39;Designed for handling analytical queries and generating SQL code to retrieve and analyze data from databases about products purchased, payments made, refunds, customer reviews etc. This retriever is ideal for answering questions that require data retrieval, aggregation, filtering, or sorting based on specific criteria such as device/client status, usage statistics, counts, extremes (highest/lowest), and much more. It can return numerical or short string results or sets of relevant documents to show and answer users questions.&#39;</span><span class=p>,</span>
<span class=s2>&quot;retriever&quot;</span><span class=p>:</span> <span class=n>sql_retriever</span>
<span class=p>}</span>
<span class=p>]</span>
</code></pre></div> <p>Now, we will create a default chain that will be used by the MultiRetrievalQAChain later on in this notebook. Take a note at how you can customize this by using your own prompt. This is another area that you can optimize for if you are seeing any unexpected behavior specifically by the default chain.</p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>define</span> <span class=n>Bedrock</span> <span class=n>Chat</span> <span class=n>Model</span><span class=p>:</span> <span class=n>Claude</span> <span class=mf>3.0</span> <span class=ow>is</span> <span class=n>only</span> <span class=n>supported</span> <span class=ow>in</span> <span class=n>BedrockChat</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>llm</span> <span class=o>=</span> <span class=n>BedrockChat</span><span class=p>(</span><span class=n>model_id</span> <span class=o>=</span> <span class=n>model_id</span><span class=p>,</span>
                  <span class=n>model_kwargs</span><span class=o>=</span><span class=n>inference_params</span><span class=p>,</span> 
                  <span class=n>streaming</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                  <span class=n>callbacks</span><span class=o>=</span><span class=p>[</span><span class=n>StreamingStdOutCallbackHandler</span><span class=p>()],</span>
                  <span class=n>client</span> <span class=o>=</span> <span class=n>boto3_bedrock</span>
                 <span class=p>)</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Custom</span> <span class=n>Prompt</span> <span class=k>for</span> <span class=n>the</span> <span class=n>default</span> <span class=n>chain</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>default_chain_prompt</span> <span class=o>=</span> <span class=n>PromptTemplate</span><span class=p>(</span>
    <span class=n>input_variables</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;query&quot;</span><span class=p>,</span> <span class=s2>&quot;history&quot;</span><span class=p>],</span>
    <span class=n>template</span><span class=o>=</span><span class=s2>&quot;&quot;&quot;You are a helpful assistant who answers user queries using the</span>
<span class=s2>    contexts provided. If the question cannot be answered using the information</span>
<span class=s2>    provided say &quot;I don&#39;t know&quot;.</span>
<span class=s2>    </span><span class=si>{history}</span>
<span class=s2>    Question: </span><span class=si>{query}</span><span class=s2>&quot;&quot;&quot;</span>
<span class=p>)</span>

<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Default</span> <span class=n>Chain</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>default_chain</span> <span class=o>=</span> <span class=n>ConversationChain</span><span class=p>(</span><span class=n>llm</span><span class=o>=</span><span class=n>llm</span><span class=p>,</span> 
                                  <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>,</span> 
                                  <span class=n>prompt</span><span class=o>=</span><span class=n>default_chain_prompt</span><span class=p>,</span> 
                                  <span class=n>input_key</span><span class=o>=</span><span class=s1>&#39;query&#39;</span><span class=p>,</span>
                                  <span class=n>output_key</span><span class=o>=</span><span class=s1>&#39;result&#39;</span><span class=p>)</span>
</code></pre></div> <p>Now, we will configure a memory that will be used by the MultiRetrievalQAChain later on in this notebook. This is used to provide historical context to MultiRetrievalQAChain.</p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>add</span> <span class=n>memory</span> <span class=n>buffer</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>memory</span> <span class=o>=</span> <span class=n>ConversationBufferMemory</span><span class=p>(</span><span class=n>memory_key</span><span class=o>=</span><span class=s2>&quot;MultiRetrievers&quot;</span><span class=p>,</span> 
                                  <span class=n>return_messages</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> 
                                  <span class=n>input_key</span><span class=o>=</span><span class=s2>&quot;input&quot;</span><span class=p>,</span>
                                  <span class=n>output_key</span><span class=o>=</span><span class=s2>&quot;result&quot;</span><span class=p>,</span> <span class=p>)</span>
</code></pre></div> <p>Finally, we will use all the resources created above to configure a MultiRetrievalQAChain. This will contains the retrievers and their information using <code>retriever_infos</code>, the default chain using <code>default_chain</code>, and memory buffer using <code>memory</code>. You can optionally choose to have a default retriever and a default prompt to further optimize the behavior of MultiRetrievalQAChain.</p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Create</span> <span class=n>the</span> <span class=n>multi</span><span class=o>-</span><span class=n>retriever</span> <span class=n>chain</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>multi_retrieval_qa_chain</span> <span class=o>=</span> <span class=n>MultiRetrievalQAChain</span><span class=o>.</span><span class=n>from_retrievers</span><span class=p>(</span>
    <span class=n>llm</span><span class=o>=</span><span class=n>llm</span><span class=p>,</span>
    <span class=n>retriever_infos</span><span class=o>=</span><span class=n>retriever_infos</span><span class=p>,</span>
    <span class=n>default_chain</span><span class=o>=</span><span class=n>default_chain</span><span class=p>,</span>
    <span class=n>memory</span><span class=o>=</span><span class=n>memory</span><span class=p>,</span>
    <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span>    <span class=n>default_retriever</span><span class=p>:</span> <span class=n>optional</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span>    <span class=n>default_prompt</span><span class=p>:</span> <span class=n>optional</span> <span class=c1># check below cell for more information on this&lt;/h2&gt;</span>
<span class=p>)</span>
</code></pre></div> <p>Before we move forward, it is important to understand how does Multiretriever QA chain decides which retriever to use to answer user's question?</p> <p>It uses the prompt below along with the description of the retrievers i.e. <code>retriever_infos</code> list in above cell. So, if you are facing issues with incorrect routing, you may want to optimize and simplify the description you have for the retrievers. </p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Check</span> <span class=n>the</span> <span class=n>prompt</span> <span class=n>used</span> <span class=n>to</span> <span class=n>route</span> <span class=n>the</span> <span class=n>question</span> <span class=n>to</span> <span class=n>relevant</span> <span class=n>retriver</span><span class=p>:</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=kn>from</span> <span class=nn>langchain.chains.router.multi_retrieval_prompt</span> <span class=kn>import</span> <span class=p>(</span>
    <span class=n>MULTI_RETRIEVAL_ROUTER_TEMPLATE</span><span class=p>,</span>
<span class=p>)</span>

<span class=nb>print</span><span class=p>(</span><span class=n>MULTI_RETRIEVAL_ROUTER_TEMPLATE</span><span class=p>)</span>
</code></pre></div> <h3>Test MultiRetrievalQAChain Chain</h3> <h4>Using Knowledge Bases for Amazon Bedrock</h4> <p>Let's ask a question that we know can be answered by the associated knowledge base and see if the multiretrieval chain can route the question to the correct retriever.</p> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>time</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>Test</span> <span class=n>the</span> <span class=n>chain</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;By what percentage did AWS revenue grow year-over-year in 2022?&quot;</span>
<span class=n>result</span> <span class=o>=</span> <span class=n>multi_retrieval_qa_chain</span><span class=p>({</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>})</span>
</code></pre></div> <h4>Using Custom SQL Retriever</h4> <p>You have explored Knowledgebase for Amazon bedrock quite a bit in this workshop, lets focus more on the concept of RAG here. We will ask questions that we know can be answered by using SQL but lets test if the multiretrieval QA chain can route the question to correct chain.</p> <p>Notice how the total duration to complete the request is so quick and probably better than most solutions out there for <code>Text-to-SQL</code>.</p> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>time</span>
<span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;What is the total spending by all customers?&quot;</span>
<span class=n>result</span> <span class=o>=</span> <span class=n>multi_retrieval_qa_chain</span><span class=p>({</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>})</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>sql_retriever</span><span class=o>.</span><span class=n>get_relevant_documents</span><span class=p>(</span><span class=n>query</span><span class=p>)</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>time</span>
<span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;What is the most ordered item?&quot;</span>
<span class=n>result</span> <span class=o>=</span> <span class=n>multi_retrieval_qa_chain</span><span class=p>({</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>})</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>sql_retriever</span><span class=o>.</span><span class=n>get_relevant_documents</span><span class=p>(</span><span class=n>query</span><span class=p>)</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>time</span>
<span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;How many customers wrote a review about product?&quot;</span>
<span class=n>result</span> <span class=o>=</span> <span class=n>multi_retrieval_qa_chain</span><span class=p>({</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>})</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>sql_retriever</span><span class=o>.</span><span class=n>get_relevant_documents</span><span class=p>(</span><span class=n>query</span><span class=p>)</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
</code></pre></div> <h3>Test default chain</h3> <p>Multiretrieval QA chains also have a default chain that uses LLM model's knowledge to answer question when the question cannot be determined to be answered by various retriever associated with the chain. You can also define your customized prompt to adjust the responses of the default chain. </p> <p>Now, lets ask a question that will trigger default chain in our case.</p> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>time</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>This</span> <span class=n>question</span> <span class=ow>is</span> <span class=n>completely</span> <span class=n>unrelated</span> <span class=n>to</span> <span class=nb>any</span> <span class=n>of</span> <span class=n>the</span> <span class=n>information</span> <span class=n>provided</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>retriever</span><span class=s1>&#39;s configuration.&lt;/h2&gt;</span>
<span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;What is going on in the world?&quot;</span>
<span class=n>result</span> <span class=o>=</span> <span class=n>multi_retrieval_qa_chain</span><span class=p>({</span><span class=s2>&quot;input&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>})</span>
<span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>sql_retriever</span><span class=o>.</span><span class=n>get_relevant_documents</span><span class=p>(</span><span class=n>query</span><span class=p>)</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
</code></pre></div> <h3>Finally, let's look at the current memory buffer</h3> <p>Here is complete context that the application currently has should a new question is asked</p> <div class=highlight><pre><span></span><code><span class=o>&lt;</span><span class=n>h2</span><span class=o>&gt;</span><span class=n>current</span> <span class=n>memory</span> <span class=n>buffer</span><span class=o>&lt;/</span><span class=n>h2</span><span class=o>&gt;</span>
<span class=n>multi_retrieval_qa_chain</span><span class=o>.</span><span class=n>memory</span><span class=o>.</span><span class=n>buffer</span>
</code></pre></div> <h2>Cleanup</h2> <p>Please make sure to delete all the resources that were created as you will be incurred cost for storing documents in OSS index.</p> <p>To delete Knowledge base resources, check clean up steps <a href=https://github.com/aws-samples/amazon-bedrock-samples/blob/main/knowledge-bases/features-examples/01-rag-concepts/01_create_ingest_documents_test_kb_multi_ds.ipynb>here</a></p> <p>To delete the Glue database and table, run the cell below.</p> <div class=highlight><pre><span></span><code><span class=n>glue_client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;glue&#39;</span><span class=p>)</span>
<span class=n>glue_client</span><span class=o>.</span><span class=n>delete_database</span><span class=p>(</span><span class=n>Name</span><span class=o>=</span><span class=n>database</span><span class=p>)</span>
</code></pre></div> <h2>Whats Next?</h2> <p>Now that you have a good understanding of custom retrievers, you may want to optimize the SQL prompts, Retriver Information and description, optimize default prompt to customize the model response to your business or project needes.</p> <p>If you need even faster response, you can pre-prepare your data such that its more easily accessible and does not require join or complex conditions. You could also optimize the time delay to check and fetch the results after a query has completed successfully.</p> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by <a href="https://github.com/aws-samples/amazon-bedrock-samples/issues/new?title=[Online Feedback]: Short-Summary-of-Issue&body=Page URL: /rag/knowledge-bases/use-case-examples/rag-using-structured-unstructured-data/2_rag_with_structured_unstructured_data/" target=_blank rel=noopener>creating an issue</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../1_create_sql_dataset_optional/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Create SQL Dataset (Optional)"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Create SQL Dataset (Optional) </div> </div> </a> <a href=../../../../open-source/chatbots/qa_chatbot_langchain_bedrock/ class="md-footer__link md-footer__link--next" aria-label="Next: Chatbot using Langchain"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Chatbot using Langchain </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved. </div> </div> <div class=md-social> <a href=https://github.com/aws-samples/amazon-bedrock-samples/tree/main target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["tags", "toc.integrate", "content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "search.highlight", "search.suggest"], "search": "../../../../../assets/javascripts/workers/search.6ce7567c.min.js", "tags": {"Compatibility": "compat"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../../assets/javascripts/bundle.88dd0f4e.min.js></script> <script src=../../../../../javascript/feedback.js></script> </body> </html>