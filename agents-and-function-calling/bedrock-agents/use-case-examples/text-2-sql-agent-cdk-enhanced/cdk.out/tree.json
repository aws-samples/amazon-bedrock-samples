{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.201.0"},"children":{"text-2-sql2":{"id":"text-2-sql2","path":"text-2-sql2","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.201.0"},"children":{"SchemaBucket":{"id":"SchemaBucket","path":"text-2-sql2/SchemaBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.201.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"text-2-sql2/SchemaBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"aws-cdk:cr-owned:data/EV_WA/:6885267e","value":"true"}]}}},"Policy":{"id":"Policy","path":"text-2-sql2/SchemaBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.201.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"text-2-sql2/SchemaBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"SchemaBucket79EE2269"},"policyDocument":{"Statement":[{"Action":["s3:PutBucketPolicy","s3:GetBucket*","s3:List*","s3:DeleteObject*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"text-2-sql2/SchemaBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.201.0","metadata":[]},"children":{"Default":{"id":"Default","path":"text-2-sql2/SchemaBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.201.0"}}}}}},"LatestNodeRuntimeMap":{"id":"LatestNodeRuntimeMap","path":"text-2-sql2/LatestNodeRuntimeMap","constructInfo":{"fqn":"aws-cdk-lib.CfnMapping","version":"2.201.0"}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"text-2-sql2/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.201.0"},"children":{"Staging":{"id":"Staging","path":"text-2-sql2/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.201.0"}},"Role":{"id":"Role","path":"text-2-sql2/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.201.0"}},"Handler":{"id":"Handler","path":"text-2-sql2/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.201.0"}}}},"DeployFiles":{"id":"DeployFiles","path":"text-2-sql2/DeployFiles","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_deployment.BucketDeployment","version":"2.201.0"},"children":{"AwsCliLayer":{"id":"AwsCliLayer","path":"text-2-sql2/DeployFiles/AwsCliLayer","constructInfo":{"fqn":"aws-cdk-lib.lambda_layer_awscli.AwsCliLayer","version":"2.201.0","metadata":[]},"children":{"Code":{"id":"Code","path":"text-2-sql2/DeployFiles/AwsCliLayer/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.201.0"},"children":{"Stage":{"id":"Stage","path":"text-2-sql2/DeployFiles/AwsCliLayer/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.201.0"}},"AssetBucket":{"id":"AssetBucket","path":"text-2-sql2/DeployFiles/AwsCliLayer/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.201.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"text-2-sql2/DeployFiles/AwsCliLayer/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnLayerVersion","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::LayerVersion","aws:cdk:cloudformation:props":{"content":{"s3Bucket":{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"},"s3Key":"b8ab94266984268614c3fb2824a1c3a55395746c48b28c003b08bc1d08688f3e.zip"},"description":"/opt/awscli/aws"}}}}},"CustomResourceHandler":{"id":"CustomResourceHandler","path":"text-2-sql2/DeployFiles/CustomResourceHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.201.0","metadata":[]}},"Asset1":{"id":"Asset1","path":"text-2-sql2/DeployFiles/Asset1","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.201.0"},"children":{"Stage":{"id":"Stage","path":"text-2-sql2/DeployFiles/Asset1/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.201.0"}},"AssetBucket":{"id":"AssetBucket","path":"text-2-sql2/DeployFiles/Asset1/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.201.0","metadata":[]}}}},"CustomResource":{"id":"CustomResource","path":"text-2-sql2/DeployFiles/CustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.201.0","metadata":[]},"children":{"Default":{"id":"Default","path":"text-2-sql2/DeployFiles/CustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.201.0"}}}}}},"Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C":{"id":"Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.201.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.201.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.201.0","metadata":[]}},"Resource":{"id":"Resource","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.201.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::",{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"}]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::",{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"},"/*"]]}]},{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF","roles":[{"Ref":"CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265"}]}}}}}}},"Code":{"id":"Code","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.201.0"},"children":{"Stage":{"id":"Stage","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.201.0"}},"AssetBucket":{"id":"AssetBucket","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.201.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"text-2-sql2/Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"},"s3Key":"9a1fcb4a7ecba81ad70e9d3fb241f6794497da945dae5f25924e4dd002b65f2d.zip"},"environment":{"variables":{"AWS_CA_BUNDLE":"/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem"}},"handler":"index.handler","layers":[{"Ref":"DeployFilesAwsCliLayerF562E16D"}],"role":{"Fn::GetAtt":["CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265","Arn"]},"runtime":"python3.11","timeout":900}}}}},"GlueRole":{"id":"GlueRole","path":"text-2-sql2/GlueRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.201.0","metadata":[]},"children":{"ImportGlueRole":{"id":"ImportGlueRole","path":"text-2-sql2/GlueRole/ImportGlueRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.201.0","metadata":[]}},"Resource":{"id":"Resource","path":"text-2-sql2/GlueRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"glue.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSGlueServiceRole"]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonS3FullAccess"]]}]}}}}},"GlueDatabase":{"id":"GlueDatabase","path":"text-2-sql2/GlueDatabase","constructInfo":{"fqn":"aws-cdk-lib.aws_glue.CfnDatabase","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Glue::Database","aws:cdk:cloudformation:props":{"catalogId":{"Ref":"AWS::AccountId"},"databaseInput":{"name":"ev_wa"}}}},"MyCrawler":{"id":"MyCrawler","path":"text-2-sql2/MyCrawler","constructInfo":{"fqn":"aws-cdk-lib.aws_glue.CfnCrawler","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Glue::Crawler","aws:cdk:cloudformation:props":{"databaseName":"ev_wa","role":{"Fn::GetAtt":["GlueRoleDEDFFD2C","Arn"]},"schedule":{"scheduleExpression":"cron(0/1 * * * ? *)"},"targets":{"s3Targets":[{"path":{"Fn::Join":["",["s3://",{"Ref":"SchemaBucket79EE2269"},"/data/EV_WA/"]]}}]}}}},"ActionGroupFunction":{"id":"ActionGroupFunction","path":"text-2-sql2/ActionGroupFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.201.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"text-2-sql2/ActionGroupFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.201.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"text-2-sql2/ActionGroupFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.201.0","metadata":[]}},"Resource":{"id":"Resource","path":"text-2-sql2/ActionGroupFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"text-2-sql2/ActionGroupFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.201.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"text-2-sql2/ActionGroupFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"glue:StartJobRun","Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:glue:us-east-1:",{"Ref":"AWS::AccountId"},":job/*"]]}},{"Action":["glue:GetDatabase","glue:GetDatabases","glue:GetTable","glue:GetTables","glue:BatchGetPartition","glue:GetPartition","glue:GetPartitions","glue:BatchCreatePartition","glue:CreatePartition","glue:DeletePartition","glue:UpdatePartition","glue:BatchDeletePartition"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:aws:glue:us-east-1:",{"Ref":"AWS::AccountId"},":catalog"]]},{"Fn::Join":["",["arn:aws:glue:us-east-1:",{"Ref":"AWS::AccountId"},":database/ev_wa"]]},{"Fn::Join":["",["arn:aws:glue:us-east-1:",{"Ref":"AWS::AccountId"},":table/ev_wa/*"]]}]},{"Action":["s3:PutObject","s3:GetObject","s3:ListBucket","s3:CreateBucket","s3:GetBucketLocation"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},"/*"]]}]},{"Action":["athena:StartQueryExecution","athena:GetQueryExecution","athena:GetQueryResults","athena:StopQueryExecution","athena:GetWorkGroup"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:aws:athena:us-east-1:",{"Ref":"AWS::AccountId"},":workgroup/primary"]]}}],"Version":"2012-10-17"},"policyName":"ActionGroupFunctionServiceRoleDefaultPolicyA247E007","roles":[{"Ref":"ActionGroupFunctionServiceRole77660D62"}]}}}}}}},"Code":{"id":"Code","path":"text-2-sql2/ActionGroupFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.201.0"},"children":{"Stage":{"id":"Stage","path":"text-2-sql2/ActionGroupFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.201.0"}},"AssetBucket":{"id":"AssetBucket","path":"text-2-sql2/ActionGroupFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.201.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"text-2-sql2/ActionGroupFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"},"s3Key":"45290291bd8e83e88a36be938e42b08b647cef8cce308a545e5768e47ae5af70.zip"},"environment":{"variables":{"outputLocation":{"Fn::Join":["",["s3://",{"Ref":"SchemaBucket79EE2269"},"/athena_result/"]]},"glue_database_name":"ev_wa","region":"us-east-1","bucket_name":{"Ref":"SchemaBucket79EE2269"}}},"handler":"index.lambda_handler","memorySize":512,"role":{"Fn::GetAtt":["ActionGroupFunctionServiceRole77660D62","Arn"]},"runtime":"python3.9","timeout":300}}},"LambdaInvocationPolicy-c865ed35ebbfcb26":{"id":"LambdaInvocationPolicy-c865ed35ebbfcb26","path":"text-2-sql2/ActionGroupFunction/LambdaInvocationPolicy-c865ed35ebbfcb26","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ActionGroupFunctionFE14D1CB","Arn"]},"principal":"bedrock.amazonaws.com","sourceAccount":{"Ref":"AWS::AccountId"},"sourceArn":{"Fn::GetAtt":["MyAgentAgentResource30A5B35B","AgentArn"]}}}},"AllowBedrockInvoke":{"id":"AllowBedrockInvoke","path":"text-2-sql2/ActionGroupFunction/AllowBedrockInvoke","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ActionGroupFunctionFE14D1CB","Arn"]},"principal":"bedrock.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:bedrock:us-east-1:",{"Ref":"AWS::AccountId"},":agent/*"]]}}}}}},"MyAgent":{"id":"MyAgent","path":"text-2-sql2/MyAgent","constructInfo":{"fqn":"@cdklabs/generative-ai-cdk-constructs.bedrock.Agent","version":"0.1.309","metadata":[]},"children":{"Role":{"id":"Role","path":"text-2-sql2/MyAgent/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.201.0","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"text-2-sql2/MyAgent/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.201.0","metadata":[]}},"Resource":{"id":"Resource","path":"text-2-sql2/MyAgent/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Condition":{"StringEquals":{"aws:SourceAccount":{"Ref":"AWS::AccountId"}},"ArnLike":{"aws:SourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":bedrock:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":agent/*"]]}}},"Effect":"Allow","Principal":{"Service":"bedrock.amazonaws.com"}}],"Version":"2012-10-17"},"roleName":"AmazonBedrockExecutionRoleForAgents_text2sql2MyAgentAC35032F"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"text-2-sql2/MyAgent/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.201.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"text-2-sql2/MyAgent/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["bedrock:InvokeModel*","bedrock:GetFoundationModel"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":bedrock:",{"Ref":"AWS::Region"},"::foundation-model/anthropic.claude-3-5-sonnet-20240620-v1:0"]]}},{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["ActionGroupFunctionFE14D1CB","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ActionGroupFunctionFE14D1CB","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"MyAgentRoleDefaultPolicy30DBC7AC","roles":[{"Ref":"MyAgentRoleE8318EBB"}]}}}}}}},"AgentResource":{"id":"AgentResource","path":"text-2-sql2/MyAgent/AgentResource","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnAgent","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::Agent","aws:cdk:cloudformation:props":{"actionGroups":[{"actionGroupName":"UserInputAction","actionGroupState":"ENABLED","parentActionGroupSignature":"AMAZON.UserInput","skipResourceInUseCheckOnDelete":false},{"actionGroupName":"CodeInterpreterAction","actionGroupState":"DISABLED","parentActionGroupSignature":"AMAZON.CodeInterpreter","skipResourceInUseCheckOnDelete":false},{"actionGroupExecutor":{"lambda":{"Fn::GetAtt":["ActionGroupFunctionFE14D1CB","Arn"]}},"actionGroupName":"QueryAthenaActionGroup","actionGroupState":"ENABLED","apiSchema":{"payload":"{\n    \"openapi\": \"3.0.0\",\n    \"info\": {\n        \"title\": \"Database schema look up and query APIs\",\n        \"version\": \"1.0.0\",\n        \"description\": \"APIs for looking up database table schemas and making queries to database tables.\"\n    },\n    \"paths\": {\n        \"/getschema\": {\n            \"get\": {\n                \"summary\": \"Get a list of all tables and their schema in the database\",\n                \"description\": \"Get the list of all tables and their schema. Return all the table and schema information.\",\n                \"operationId\": \"getschema\",\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"Gets the list of table names and their schemas in the database\",\n                        \"content\": {\n                            \"application/json\": {\n                                \"schema\": {\n                                    \"type\": \"array\",\n                                    \"items\": {\n                                        \"type\": \"object\",\n                                        \"properties\": {\n                                            \"Table\": {\n                                                \"type\": \"string\",\n                                                \"description\": \"The name of the table in the database.\"\n                                            },\n                                            \"Schema\": {\n                                                \"type\": \"string\",\n                                                \"description\": \"The schema of the table in the database. Contains all columns needed for making queries.\"\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        },\n        \"/querydatabase\": {\n            \"post\": {\n                \"summary\": \"API to send SQL query to the database table\",\n                \"description\": \"Send a SQL query to the database table to retrieve information pertaining to the users question . The API takes in only one SQL query at a time, sends the SQL statement and returns the query results from the table. This API should be called for each SQL query to a database table.\",\n                \"operationId\": \"querydatabase\",\n                \"requestBody\": {\n                    \"required\": true,\n                    \"content\": {\n                        \"application/json\": {\n                            \"schema\": {\n                                \"type\": \"object\",\n                                \"properties\": {\n                                    \"query\": {\n                                        \"type\": \"string\",\n                                        \"description\": \"SQL statement to query database table.\"\n                                    }\n                                },\n                                \"required\": [\n                                    \"query\"\n                                ]\n                            }\n                        }\n                    }\n                },\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"Query sent successfully\",\n                        \"content\": {\n                            \"application/json\": {\n                                \"schema\": {\n                                    \"type\": \"object\",\n                                    \"properties\": {\n                                        \"responsebody\": {\n                                            \"type\": \"string\",\n                                            \"description\": \"The query response from the database.\"\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    },\n                    \"400\": {\n                        \"description\": \"Bad request. One or more required fields are missing or invalid.\"\n                    }\n                }\n            }\n        }\n    }\n}"},"description":"Actions for getting the database schema and querying the Athena database for sample data or final query.","skipResourceInUseCheckOnDelete":false}],"agentName":"bedrock-agent-text2sql2-myagent-ac35032f","agentResourceRoleArn":{"Fn::GetAtt":["MyAgentRoleE8318EBB","Arn"]},"autoPrepare":true,"description":"Agent for performing sql queries.","foundationModel":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":bedrock:",{"Ref":"AWS::Region"},"::foundation-model/anthropic.claude-3-5-sonnet-20240620-v1:0"]]},"idleSessionTtlInSeconds":3600,"instruction":"As an advanced database querying agent, your primary task is to generate precise SQL queries concerning the ev_wa database, adhering to the following strict guidelines:\n\n1. Craft syntactically correct AWS Athena queries tailored to specific questions posed by users.\n2. Ensure queries are efficient by targeting only relevant columns instead of extracting all data from any table.\n3. Utilize only column names visible in the schema description to avoid referencing non-existent columns.\n4. Accurately identify the table each column belongs to and appropriately qualify column names with their respective table names as necessary.\n5. Always enclose table names and column names in DOUBLE quotes, as this is the required format for AWS Athena and helps prevent potential errors due to case sensitivity or special characters.\n6. For queries involving filters based on categorical data, first generate a sample SQL query (using DISTINCT) against relevant tables to familiarize yourself with the content of a particular column.\n7. After reviewing the schema of the entire ev_wa database and the columns of the tables, decide on your final SQL query to answer the question thoroughly. Remember, you might need to perform joins between tables to provide a comprehensive answer or provide an AWS S3 link for the response.\n\nConstructing effective and accurate queries requires a deep understanding of the relationships within the database. The following examples illustrate the kind of queries you should be able to construct based on the available data:\n\n- Table `vehicle_info` example query: SELECT \"VIN (1-10)\", \"Model Year\", \"Electric Vehicle Type\" FROM \"vehicle_info\" LIMIT 5;\n- Table `vehicle_economics` example query: SELECT \"VIN (1-10)\", \"Electric Range\", \"Base MSRP\", \"Clean Alternative Fuel Vehicle (CAFV) Eligibility\" FROM \"vehicle_economics\" LIMIT 5;\n- Table `geo_identifiers` example query: SELECT \"VIN (1-10)\", \"Legislative District\", \"DOL Vehicle ID\", \"Vehicle Location\", \"2020 Census Tract\" FROM \"geo_identifiers\" LIMIT 5;\n- Table `owner_location` example query: SELECT \"VIN (1-10)\", \"Postal Code\", \"Electric Utility\" FROM \"owner_location\" LIMIT 5;\n\nYour final SQL queries should be tailored to answer users' questions accurately, efficiently, and in adherence to the specified guidelines.","skipResourceInUseCheckOnDelete":false}}},"DefaultAlias":{"id":"DefaultAlias","path":"text-2-sql2/MyAgent/DefaultAlias","constructInfo":{"fqn":"@cdklabs/generative-ai-cdk-constructs.bedrock.AgentAliasBase","version":"0.1.309","metadata":[]}}}},"AgentRole":{"id":"AgentRole","path":"text-2-sql2/AgentRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.201.0","metadata":[]},"children":{"ImportAgentRole":{"id":"ImportAgentRole","path":"text-2-sql2/AgentRole/ImportAgentRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.201.0","metadata":[]}},"Resource":{"id":"Resource","path":"text-2-sql2/AgentRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"bedrock.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"text-2-sql2/AgentRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.201.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"text-2-sql2/AgentRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.201.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject","s3:ListBucket"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["SchemaBucket79EE2269","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"AgentRoleDefaultPolicy1027F5D2","roles":[{"Ref":"AgentRoleF4A42D6B"}]}}}}}}},"CDKMetadata":{"id":"CDKMetadata","path":"text-2-sql2/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"text-2-sql2/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.201.0"}},"Condition":{"id":"Condition","path":"text-2-sql2/CDKMetadata/Condition","constructInfo":{"fqn":"aws-cdk-lib.CfnCondition","version":"2.201.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"text-2-sql2/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.201.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"text-2-sql2/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.201.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}